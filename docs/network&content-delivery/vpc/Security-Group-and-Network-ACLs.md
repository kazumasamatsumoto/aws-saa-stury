# セキュリティグループとネットワーク ACL（アクセスコントロールリスト）

AWS 環境におけるネットワークセキュリティを確保するために、**セキュリティグループ**と**ネットワーク ACL（NACL）**は重要な役割を果たします。本ドキュメントでは、これらのコンポーネントの違い、設定方法、特徴について詳しく解説します。

## セキュリティグループ

### 概要

セキュリティグループは、**仮想ファイアウォール**として機能し、EC2 インスタンスやその他のリソースへのトラフィックを制御します。セキュリティグループは**インスタンス（Elastic Network Interface: ENI）**に関連付けられます。

### 特徴

- **設定単位**: インスタンス単位で適用されます。
- **通信ルール**: インバウンド（受信）およびアウトバウンド（送信）のトラフィックを制御しますが、デフォルトではアウトバウンドは全許可です。
- **ステートフル**:
  - **自動応答**: インバウンドの許可ルールに基づいて、アウトバウンドのレスポンスも自動的に許可されます。
  - **シンプルな設定**: 設定が容易で、特にインバウンドの設定のみを行うことが多いです。
- **詳細な制御内容**:
  - **プロトコル**（例: TCP, UDP, ICMP）
  - **ポート番号**
  - **CIDR ブロック**（IP アドレス範囲）

### 利用シナリオ

- **インスタンス間の通信制御**: セキュリティグループを階層化し、異なるセキュリティグループ間の通信を制御することが可能です。
- **特定ポートの開放**: Web サーバーの 80 番ポートや 443 番ポートのみを開放するなど、必要最低限のポートを許可します。

## ネットワーク ACL（NACL）

### 概要

ネットワーク ACL は、**サブネット単位**で適用されるアクセスコントロールリストです。すべてのトラフィックに対して許可または拒否のルールを設定できます。

### 特徴

- **設定単位**: サブネット単位で適用され、サブネット内のすべてのインスタンスに影響します。
- **通信ルール**: インバウンド（受信）およびアウトバウンド（送信）の両方のトラフィックを制御します。
- **ステートレス**:
  - **明示的な許可・拒否**: 各トラフィックに対して明示的に許可または拒否のルールを設定する必要があります。
  - **優先度順の評価**: ルールは番号順に評価され、最初に一致したルールが適用されます。
- **詳細な制御内容**:
  - **プロトコル**
  - **ポート番号**
  - **CIDR ブロック**

### 利用シナリオ

- **広範なトラフィック制御**: サブネット全体に対してポリシーを設定することで、より広範な制御が可能です。
- **セキュリティレイヤーの追加**: セキュリティグループと組み合わせて、二重のセキュリティレイヤーを構築します。

## セキュリティグループとネットワーク ACL の比較

| 特徴             | セキュリティグループ                     | ネットワーク ACL                           |
| ---------------- | ---------------------------------------- | ------------------------------------------ |
| **適用単位**     | インスタンス（ENI）                      | サブネット                                 |
| **ステート**     | ステートフル                             | ステートレス                               |
| **ルールの種類** | 許可のみ（インバウンド、アウトバウンド） | 許可と拒否（インバウンド、アウトバウンド） |
| **優先度**       | ルールの順序は重要でない                 | ルールは番号順に評価される                 |
| **用途**         | 個々のインスタンスの細かい制御           | サブネット全体の広範な制御                 |

## 設定方法

### セキュリティグループの設定

1. **AWS マネジメントコンソール**にログインします。
2. **VPC ダッシュボード**に移動し、**セキュリティグループ**を選択します。
3. **セキュリティグループの作成**をクリックし、必要なインバウンドおよびアウトバウンドルールを設定します。
4. 作成したセキュリティグループを、対象のインスタンスに関連付けます。

### ネットワーク ACL の設定

1. **AWS マネジメントコンソール**にログインします。
2. **VPC ダッシュボード**に移動し、**ネットワーク ACL**を選択します。
3. **ネットワーク ACL の作成**をクリックし、番号順にルールを設定します。
4. 対象のサブネットにネットワーク ACL を関連付けます。

## ベストプラクティス

- **セキュリティグループとネットワーク ACL の併用**: セキュリティグループでインスタンス単位の細かい制御を行い、ネットワーク ACL でサブネット全体の広範な制御を行います。
- **最小限の許可**: 必要最低限のポートとプロトコルのみを許可し、不要なトラフィックを排除します。
- **ルールの整理**: ルール番号を整理し、明確な順序で評価されるように設定します。
- **定期的なレビュー**: セキュリティ設定を定期的に見直し、不要なルールを削除します。

## 一般向け解説：セキュリティグループとネットワーク ACL とは？

### 簡単に言うと？

AWS のセキュリティ対策は、マンションのセキュリティシステムに例えることができます：

1. **セキュリティグループ**

   - 🚪 各部屋の玄関の鍵のようなもの
   - 🔐 誰を部屋に入れるか、出るかを管理

2. **ネットワーク ACL**
   - 🏢 マンションの入口の警備システムのようなもの
   - 🛡️ フロア全体への出入りを管理

### どう違うの？

```
マンションで例えると：

セキュリティグループ
- 各部屋の入口でチェック
- 一度許可した人は自由に出入り可能
- 入室を許可する人のリストだけを管理

ネットワーク ACL
- ビルの入口でチェック
- 入る時も出る時もチェックが必要
- 入れない人のブラックリストも作れる
```

### どんなことができるの？

1. **セキュリティグループでできること**

   - 👥 特定のサーバーへのアクセス制限
   - 🌐 Web サイトへの接続許可
   - 📱 アプリからのデータベース接続管理

2. **ネットワーク ACL でできること**
   - 🚫 怪しいアクセスの遮断
   - 🏢 フロア全体のセキュリティ管理
   - 🛑 特定の通信の完全ブロック

### 具体的な使用例

1. **Web サイトの保護**

   ```
   例：オンラインショップの場合
   - セキュリティグループ：お客様からの注文を受け付ける
   - ネットワーク ACL：不正アクセスをブロック
   ```

2. **社内システムの保護**
   ```
   例：社内の機密データを扱う場合
   - セキュリティグループ：社員のアクセスのみ許可
   - ネットワーク ACL：社外からの怪しい接続をブロック
   ```

### 注意点

1. **設定時の注意**

   - ⚠️ 厳しすぎる設定は正常な通信も止めてしまう
   - 📝 設定内容は必ずメモを残す
   - 🔄 定期的な見直しが重要

2. **よくあるトラブル**
   - 🚫 必要な通信まで止めてしまう
   - 😅 設定が複雑になりすぎる
   - 🤔 どちらで制御すべきか迷う

### おすすめの使い方

1. **基本的な方針**

   - まずはセキュリティグループで必要な通信だけを許可
   - その上でネットワーク ACL で不正な通信をブロック
   - 設定は段階的に行う

2. **具体的な手順**
   ```
   1. 必要な通信を洗い出す
   2. セキュリティグループで許可設定
   3. 問題ないか確認
   4. 必要に応じてネットワーク ACL で追加防御
   ```

### よくある質問

Q1: どちらを使えばいい？

- ✅ 基本はセキュリティグループから始めましょう
- 💡 追加の防御が必要な場合はネットワーク ACL も使用

Q2: 両方必要？

- 🤔 状況による
- 🛡️ 重要なシステムは両方使うと安全

Q3: 後から変更できる？

- ✅ はい、いつでも変更可能です
- 📝 変更前に影響を確認しましょう

### まとめ

セキュリティグループとネットワーク ACL は、AWS の二重のセキュリティ対策：

- 🏠 セキュリティグループ：各サーバーの守衛さん
- 🏢 ネットワーク ACL：建物全体の警備システム

使い分けのコツ：

- 💡 日常的な管理はセキュリティグループで
- 🛡️ 追加の防御はネットワーク ACL で

## まとめ

セキュリティグループとネットワーク ACL は、AWS 環境における重要なセキュリティコンポーネントです。これらを適切に設定・管理することで、ネットワークの安全性を高め、不要なトラフィックからリソースを保護することができます。環境に応じて最適な設定を行い、セキュリティを強化しましょう。
