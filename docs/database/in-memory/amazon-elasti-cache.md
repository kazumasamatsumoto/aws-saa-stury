# Amazon ElastiCache

## 概要説明（一般向け）

Amazon ElastiCache は、AWS が提供する高速なデータ処理サービスです。データベースの前に置いて、よく使うデータを一時的に保存しておくことで、アプリケーションの応答速度を大幅に向上させることができます。

### なぜ ElastiCache を使うの？

例えば、以下のような場面で効果を発揮します：

- ウェブサイトの表示を高速化したい
- スマートフォンアプリの応答速度を改善したい
- データベースへの負荷を減らしたい
- リアルタイムでデータを分析したい

### 主な機能と特徴

1. **高速なデータアクセス**

   - データベースと比べて 100 倍以上高速
   - ミリ秒以下の応答時間を実現

2. **簡単な運用**

   - AWS が自動的にメンテナンス
   - 障害が起きた場合も自動で復旧
   - 容量の増減も簡単

3. **コスト管理**
   - 使用した分だけの支払い
   - 長期利用の場合は予約割引が可能
   - 無料のバックアップ領域あり

## 技術詳細

### 1. Redis と Memcached の比較

#### 機能比較表

| 機能                  | Redis                                                                                | Memcached                                      |
| --------------------- | ------------------------------------------------------------------------------------ | ---------------------------------------------- |
| データ型              | Strings, Hashes, Lists, Sets, Sorted Sets, Bitmaps, Geospatial indexes, HyperLogLogs | Key-Value ペアのみ（文字列、バイトストリーム） |
| データ永続性          | ✓（ディスク永続性）                                                                  | ×（メモリ内のみ）                              |
| レプリケーション      | マスター・スレーブ                                                                   | 手動設定                                       |
| パーティショニング    | 水平パーティショニング/シャーディング                                                | ハッシュベースの単純なパーティショニング       |
| 並行性                | シングルスレッド                                                                     | マルチスレッド                                 |
| アトミック操作        | 複雑なデータタイプに対する幅広い操作                                                 | 文字列や数字に対する限定的な操作               |
| バックアップ/リストア | ✓                                                                                    | ×                                              |
| トランザクション      | ✓                                                                                    | ×                                              |
| Pub/Sub               | ✓                                                                                    | ×                                              |
| 主な用途              | キャッシング、リアルタイム分析、地理情報データ、メッセージング                       | キャッシング、DB の負荷軽減                    |

### 2. MemoryDB と ElastiCache の比較

| 特徴             | MemoryDB for Redis               | ElastiCache for Redis |
| ---------------- | -------------------------------- | --------------------- |
| 主なユースケース | プライマリデータベース           | データキャッシュ      |
| レイテンシ       | 読込：マイクロ秒<br>書込：ミリ秒 | 読込/書込：マイクロ秒 |
| データの耐久性   | あり                             | キャッシュ            |
| クラスタリング   | クラスタリング                   | クラスタモード on/off |

### 3. ElastiCache for Memcached

#### 構造と特徴

- クラスターあたり 1-20 ノード
- 自動障害検知と置換
- クライアント側でノード選択（負荷分散）

#### スケーリング

- ノードごとに個別エンドポイント
- AWS SDK による自動ノード検出
- 垂直スケーリング（ノードスペック変更）
- データ非永続のため、新クラスター作成で移行

### 4. ElastiCache for Redis

#### 構造

- ノードグループ（シャード）構成
- プライマリノードと 0-5 個のレプリカ
- クラスター/シャード/ノードレベルのエンドポイント

#### クラスタモード比較

| 特徴               | クラスタモード無効     | クラスタモード有効          |
| ------------------ | ---------------------- | --------------------------- |
| ノード構成         | 単一ノード             | 最大 500 ノード             |
| パーティショニング | なし                   | マルチシャード              |
| スケーリング       | 垂直（メモリ追加）     | 水平（シャード/ノード追加） |
| フェイルオーバー   | レプリカへ             | シャード内レプリカへ        |
| マルチキー操作     | 全サポート             | シャード内のみ              |
| 使用例             | 低スケーラビリティ要件 | 大規模アプリケーション      |

#### グローバルデータストア

- 1 プライマリ（RW）+ 最大 2 セカンダリ（R）リージョン
- 要件：
  - Redis 5.0.6 以上
  - R5/M5 以降のノード
  - オープンソースエディションのみ
  - 同一構成必須

### 5. 料金体系

- ノード料金（時間単位）
  - リザーブドノードで割引可
- データ転送料金（アウトバウンド）
- バックアップストレージ
  - クラスター 1 つにつき 1 スナップショット無料

## ElastiCache の 2 つの選択肢

ElastiCache には「Redis」と「Memcached」という 2 つのタイプがあります。

### Redis を選ぶべき場合

- より複雑なデータ（リスト、マップなど）を扱いたい
- データのバックアップが必要
- 複数のサーバーでデータを同期したい
- メッセージのやり取りの機能が必要

### Memcached を選ぶべき場合

- シンプルなデータ（文字列など）のみを扱う
- とにかく単純な構成で使いたい
- マルチスレッドによる高い処理能力が必要

## 料金について

以下の 3 つが主な料金要素です：

1. **ノード料金**：使用するサーバーの大きさと時間に応じた料金
2. **データ転送料金**：データを外に送る量に応じた料金
3. **バックアップ料金**：追加のバックアップを取る場合の料金
   - 基本的なバックアップ 1 つは無料

## まとめ

ElastiCache は、データベースの前に置く「高速なデータの一時置き場」として機能し、アプリケーションの性能を大幅に向上させることができます。特に:

- ウェブサイトやアプリの高速化が必要な場合
- データベースの負荷を減らしたい場合
- リアルタイムデータ処理が必要な場合

に有効な選択肢となります。
