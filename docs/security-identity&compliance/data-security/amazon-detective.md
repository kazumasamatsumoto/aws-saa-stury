# Amazon Detective

## アーキテクチャ図

![Amazon Detective Overview](/image/security-identity&compliance/data-security/amazon-detective-overview.svg)

## 概要

Amazon Detective は、AWS 環境でのセキュリティ問題や不審なアクティビティの根本原因を特定・分析するためのサービスです。機械学習とグラフ理論を活用して、セキュリティデータの自動分析と視覚化を提供します。

## 主な特徴

### データソースの統合

- AWS CloudTrail ログ
- Amazon VPC Flow Logs
- Amazon GuardDuty の調査結果
- Amazon EKS 監査ログ

### 自動化された分析機能

- 行動パターンの可視化
- エンティティプロファイリング
- 異常検知と関係性分析
- インタラクティブな可視化グラフ

## ユースケース

1. セキュリティ調査の効率化

   - 不審な IP アドレスの活動履歴追跡
   - 異常な API 呼び出しパターンの分析
   - 潜在的な脅威の影響範囲の特定

2. インシデントレスポンスの強化

   - セキュリティイベントのタイムライン作成
   - 関連するリソースの相関関係の把握
   - 攻撃経路の特定と対策

3. コンプライアンス対応
   - セキュリティイベントの詳細な記録
   - 監査証跡の保持
   - インシデント報告書の作成支援

## 統合サービス

- Amazon GuardDuty
- AWS Security Hub
- Amazon Macie
- AWS CloudTrail

## セットアップと設定

1. 有効化

   - マスターアカウントでの有効化
   - メンバーアカウントの招待と管理

2. データ収集

   - 自動的なログデータの収集
   - 行動グラフの生成
   - 分析ベースラインの確立

3. 調査の開始
   - グラフィカルコンソールでの調査
   - フィルタリングと検索
   - 時系列分析の実行

## 調査結果のユースケース例

### 1. 不正アクセスの調査

- **シナリオ**: 通常とは異なる地域からの大量のログイン試行を検出
- **Detective での分析**:
  - ログイン試行の時系列パターン可視化
  - 関連する IP アドレスの行動履歴確認
  - 影響を受けた IAM ユーザーの特定
- **対応アクション**:
  - 不正アクセスの発生源をブロック
  - 影響を受けた認証情報の無効化
  - セキュリティポリシーの見直し

### 2. データ流出の調査

- **シナリオ**: S3 バケットからの異常な大量のデータダウンロード
- **Detective での分析**:
  - データアクセスパターンの分析
  - アクセス元の IP アドレスと IAM ロールの相関関係
  - 影響を受けたデータの範囲特定
- **対応アクション**:
  - 不正なアクセスの遮断
  - データアクセスポリシーの見直し
  - 流出データの影響評価

### 3. クレデンシャル漏洩の調査

- **シナリオ**: 複数のリージョンでの同時アクセスを検出
- **Detective での分析**:
  - アクセスパターンの地理的分布確認
  - API コール履歴の異常検知
  - 権限昇格の試行有無の確認
- **対応アクション**:
  - 影響を受けた認証情報の即時無効化
  - MFA の強制適用
  - セキュリティ監査の実施

### 4. リソース乱用の調査

- **シナリオ**: 予期しない EC2 インスタンスの大量起動
- **Detective での分析**:
  - リソース作成の時系列分析
  - 関連する API アクティビティの追跡
  - 権限を持つ IAM エンティティの特定
- **対応アクション**:
  - 不正なリソースの終了
  - IAM ポリシーの制限
  - 予算アラートの設定
