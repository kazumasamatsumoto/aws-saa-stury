# AWS Lambda

AWS Lambda は、AWS が提供するサーバーレスコンピューティングサービスです。サーバーのプロビジョニングや管理を必要とせずに、コードを実行することができます。

## 主な特徴

- **サーバーレス**: インフラストラクチャの管理が不要
- **自動スケーリング**: トラフィックに応じて自動的にスケール
- **従量課金制**: 実行時間とリクエスト数に基づいて課金
- **複数のプログラミング言語対応**: Node.js, Python, Java, Go, Ruby, .NET など
- **イベントドリブン**: 様々な AWS サービスと連携可能

## ユースケース

- **API バックエンド**: API Gateway と Lambda を組み合わせた RESTful API
- **データ処理**: S3 や DynamoDB のイベントトリガーによるデータ処理
- **バッチ処理**: 定期的なジョブの実行
- **ストリーミング処理**: Kinesis と連携したリアルタイムデータ処理

## 制限事項

- **実行時間**: 最大 15 分
- **メモリ**: 128MB ～ 10GB
- **一時ストレージ**: /tmp に最大 512MB
- **同時実行数**: デフォルトで 1000（引き上げ可能）

## デプロイメント方法

1. **コンソールから直接**

   - AWS マネジメントコンソールでコードを直接編集
   - テスト実行も可能

2. **ZIP アーカイブ**

   - コードと依存関係を ZIP ファイルにパッケージング
   - S3 経由でアップロード

3. **コンテナイメージ**
   - コンテナイメージとしてデプロイ
   - Amazon ECR と連携

## ベストプラクティス

- **コールドスタート対策**

  - プロビジョンドコンカレンシーの活用
  - 依存関係の最小化
  - 適切なメモリサイズの設定

- **エラーハンドリング**

  - 適切な例外処理の実装
  - デッドレターキューの設定
  - リトライ戦略の検討

- **モニタリング**
  - CloudWatch メトリクスの活用
  - X-Ray によるトレース
  - ログの適切な設定

## コスト最適化

- 実行時間の最適化
- メモリサイズの適切な設定
- 不要な依存関係の削除
- リザーブドコンカレンシーの活用

## セキュリティ

- **IAM ロール**: 最小権限の原則に基づいた権限設定
- **VPC**: 必要に応じて VPC 内での Lambda 実行
- **暗号化**: 環境変数の暗号化
- **監査**: CloudTrail による API コールの記録

## 関連サービス

- Amazon API Gateway
- Amazon S3
- Amazon DynamoDB
- Amazon EventBridge
- AWS Step Functions
- Amazon SNS/SQS

## Lambda レイヤー

Lambda レイヤーは、ライブラリ、カスタムランタイム、その他の依存関係を含む追加のコードレイヤーです。

- **主なメリット**

  - 共通のコードを複数の関数間で共有
  - デプロイメントパッケージのサイズ削減
  - 依存関係の一元管理が可能

- **制限事項**
  - 1 つの関数に最大 5 つのレイヤーを添付可能
  - 全レイヤーの解凍後の合計サイズは 250MB 以下
  - レイヤーはリージョン固有

## バージョニングとエイリアス

### バージョニング

- 関数コードと設定の変更を追跡
- 各バージョンは一意の ARN を持つ
- バージョンは不変（変更不可）
- `$LATEST`は最新バージョンを指す

### エイリアス

- バージョンへのポインタとして機能
- 開発、ステージング、本番環境の管理に有用
- トラフィックの段階的シフトが可能（別名：加重エイリアス）
- 最大 200 個のエイリアスを作成可能

## クォータ

### 同時実行の制限

- **リージョンごとの同時実行数**: デフォルトで 1000
- **プロビジョンド同時実行**: アカウントごとに最大 10,000 単位

### ストレージとメモリ

- **デプロイメントパッケージ（.zip）**: 50MB（直接アップロード）/ 250MB（S3 経由）
- **コンテナイメージ**: 10GB
- **一時ストレージ（/tmp）**: 512MB
- **メモリ割り当て**: 128MB ～ 10GB（1MB 単位で設定可能）

### 実行制限

- **タイムアウト**: 最大 900 秒（15 分）
- **同期呼び出しのペイロード**: 6MB
- **非同期呼び出しのペイロード**: 256KB
- **環境変数**: 合計 4KB

### その他の制限

- **関数レイヤー**: 最大 5 層
- **バースト同時実行**: 500 ～ 3000（リージョンによる）
- **IAM ロールの伝播**: 最大 1 分

## まとめ

AWS Lambda は、インフラストラクチャの管理なしでアプリケーションを実行できる強力なサービスです。適切に使用することで、開発効率の向上とコスト最適化を実現できます。
