# VPC Peering

## 概要

VPC Peering（ピア接続）は、2 つの VPC 間にプライベートネットワーク接続を確立するための AWS のネットワーキングサービスです。これにより、異なる VPC 間でプライベート IP アドレスを使用して安全に通信することができます。

## 主な特徴

- 異なる AWS アカウント間での VPC 接続が可能
- 異なるリージョン間での VPC 接続が可能
- プライベート IP アドレスをそのまま利用可能
- 暗号化された通信が可能
- 低レイテンシーの通信が実現可能

## 制限事項

### CIDR 関連

- VPC 間で CIDR ブロックが重複している場合、ピア接続を確立できません

### ネットワーク構造

- 推移的なピア接続はサポートされていません
  - 例：VPC A ⟷ VPC B ⟷ VPC C の場合、VPC A と VPC C は直接通信できません

### 他のネットワークサービスとの制限

以下のサービスを介した通信は、ピア接続された VPC からは利用できません：

- VPN 接続
- AWS Direct Connect 接続
- インターネットゲートウェイ経由の接続
- NAT デバイスを介したプライベートサブネットからのインターネット接続
- VPC エンドポイントを介した AWS サービスへの接続

## セキュリティ

- セキュリティグループとネットワーク ACL を使用して、VPC 間のトラフィックを制御できます
- 各 VPC のセキュリティ設定は独立して管理可能です

## ベストプラクティス

1. 適切なルートテーブルの設定

   - ピア接続用のルートを明示的に設定
   - 適切な CIDR 範囲の指定

2. セキュリティ設定

   - 最小権限の原則に基づいたセキュリティグループの設定
   - 定期的なネットワーク ACL の見直し

3. モニタリング
   - VPC フローログを有効化してトラフィックを監視
   - CloudWatch メトリクスによる接続状態の監視

## 一般向け解説：VPC Peering とは？

### 簡単に言うと？

VPC Peering は、AWS クラウド内の異なるネットワーク（VPC）同士を「専用の直通道」で繋ぐ機能です。例えると：

- 🏢 ビル同士を専用の渡り廊下で繋ぐようなもの
- 🚇 2 つの建物を地下通路で直接繋ぐようなもの
- 📞 内線電話のような専用の通信経路

### どんなことができるの？

1. **安全な通信**

   - 🔒 インターネットを経由せずに直接通信
   - 🚀 高速な通信が可能
   - 💰 通信コストの削減

2. **異なる環境との接続**
   - 🌏 異なるリージョン（地域）のシステムと接続
   - 👥 異なる AWS アカウントのシステムと接続
   - 🔄 開発環境と本番環境の接続

### 具体的な使用例

1. **複数システム間の連携**

   ```
   例：ECサイトとバックオフィスシステムを接続
   受注システム ←→ 在庫管理システム
   ```

2. **開発環境と本番環境の分離**

   ```
   例：開発環境と本番環境を別々のVPCで管理
   開発VPC ←→ 本番VPC（必要な時だけ接続）
   ```

3. **グループ会社間のシステム連携**
   ```
   例：子会社と親会社のシステムを接続
   親会社VPC ←→ 子会社VPC
   ```

### 注意点

1. **接続の制限**

   - 🚫 A→B→C のような中継接続はできません
   - ⚠️ IP アドレスが重複すると接続できません

2. **セキュリティ**

   - 🔐 接続後も各 VPC のセキュリティ設定は独立
   - 👮 必要な通信のみを許可することが重要

3. **コスト**
   - 💰 同じリージョン内の接続は無料
   - 💸 異なるリージョン間の接続は料金が発生

### おすすめの使い方

1. **接続前の確認**

   - IP アドレスの重複がないか確認
   - 必要な通信経路を明確にする

2. **セキュリティ設定**

   - 必要最小限の通信のみを許可
   - 定期的なセキュリティ設定の見直し

3. **監視の設定**
   - 通信状況の定期的な確認
   - 異常な通信がないかチェック

### よくある質問

Q1: インターネット経由より安全なの？

- ✅ はい、AWS 内の専用線なので安全です

Q2: 接続にかかる時間は？

- ⚡ 数分で設定完了できます

Q3: 途中で切断することはできる？

- ✅ いつでも接続の解除が可能です
