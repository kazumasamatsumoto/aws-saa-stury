# Amazon Elastic Beanstalk

## 概要

Amazon Elastic Beanstalk（以下、EB）は、アプリケーションのデプロイと運用を簡素化するための PaaS ソリューションです。開発者がインフラストラクチャの管理に時間を費やすことなく、アプリケーションの開発に集中できるようにすることを目的としています。

## 解決する課題

- インフラストラクチャのセットアップと管理の複雑さ
- デプロイメントプロセスの手動操作による時間とリソースの浪費
- 本番環境の構築・運用における専門知識の必要性
- アプリケーションのスケーリングと監視の煩雑さ

## 主な機能と利点

### 1. 自動化された環境管理

- EC2 インスタンス、データベース、ロードバランサーなどのリソースを自動プロビジョニング
- キャパシティの自動調整
- ヘルスモニタリングとログ管理の自動化

### 2. マルチ環境サポート

- 開発、テスト、ステージング、本番など複数の環境を簡単に構築可能
- 環境ごとに独自のドメインを自動生成
- Blue-Green デプロイメントのサポート

### 3. 豊富なプラットフォームサポート

- Java, .NET, PHP, Node.js, Python, Ruby, Go など
- Docker コンテナのサポート
- カスタムプラットフォームの作成が可能

### 4. 開発者フレンドリー

- EB CLI によるローカル環境からの簡単なデプロイ
- Git や Jenkins との連携が容易
- AWS 管理コンソールからの視覚的な環境管理

## ユースケース

- Web アプリケーションの迅速なデプロイ
- スタートアップや小規模チームでの運用効率化
- マイクロサービスアーキテクチャの実装
- 開発環境から本番環境まで一貫した管理

## 料金

- 使用する AWS リソース（EC2、RDS、ELB など）に対してのみ課金
- Elastic Beanstalk 自体の追加料金なし

## デプロイ方式

### 1. All at once（一括デプロイ）

- すべての EC2 インスタンスに同時にデプロイ
- 最も高速だが、デプロイ中にダウンタイムが発生
- 開発環境やテスト環境に適している

### 2. Rolling（ローリングデプロイ）

- インスタンスをバッチに分けて順次デプロイ
- バッチサイズをカスタマイズ可能
- デプロイ中も一部のインスタンスでサービスを継続

### 3. Rolling with additional batch（追加バッチ付きローリング）

- 新しいインスタンスのバッチを先に起動してからデプロイを開始
- キャパシティを維持したままデプロイが可能
- デプロイ中のパフォーマンス低下を最小限に抑制

### 4. Immutable（イミュータブル）

- 新しい Auto Scaling グループで新バージョンのインスタンスを起動
- デプロイ成功後に古いインスタンスを終了
- 最も安全なデプロイ方式だが、時間とリソースを多く消費

### 5. Blue/Green（ブルー/グリーン）

- 新環境を別途作成し、Route 53 や Elastic IP で切り替え
- 完全な環境分離によるリスク最小化
- 即時ロールバックが可能
- 本番環境での大規模な変更に適している

各デプロイ方式の選択は以下の要素を考慮して決定：

- アプリケーションの重要度
- 許容可能なダウンタイム
- コスト
- デプロイ速度の要件
- ロールバックの必要性

## 環境タイプ

### 1. Web サーバー環境

- HTTP(S) リクエストを処理する Web アプリケーション向け
- ロードバランサー、Auto Scaling グループ、EC2 インスタンスで構成
- 標準的な Web アプリケーションのデプロイに使用

### 2. ワーカー環境

- バックグラウンド処理やバッチ処理を実行するための環境
- Amazon SQS キューと連携して非同期処理を実現
- Auto Scaling グループと EC2 インスタンスで構成

#### ワーカー環境の主な特徴

- SQS キューからメッセージを自動的にポーリング
- デーモンプロセスがメッセージを処理
- 処理完了後に自動的にメッセージを削除
- キューの長さに応じて Auto Scaling が可能

#### ユースケース

- メール送信処理
- 画像・動画の変換処理
- レポート生成
- データ集計・分析
- バッチ処理

#### 設定オプション

- キューの URL
- HTTP パス
- MIME タイプ
- HTTP 接続タイムアウト
- 再試行回数
- ワーカープロセス数

#### スケーリング設定

- キューメッセージ数に基づくスケーリング
- 時間ベースのスケーリング
- カスタムメトリクスによるスケーリング

## CloudFormation との比較

### Elastic Beanstalk の特徴

- アプリケーション中心のデプロイに特化
- 事前定義された環境で迅速なデプロイが可能
- インフラストラクチャの詳細を抽象化
- 限定的なカスタマイズオプション
- アプリケーションの開発チームに最適
- デプロイと運用の自動化に焦点

### CloudFormation の特徴

- より柔軟なインフラストラクチャ定義が可能
- AWS リソースを完全にカスタマイズ可能
- インフラストラクチャをコードとして管理
- 複雑なアーキテクチャの構築に対応
- インフラストラクチャチームに最適
- リソース管理の自動化に焦点

### 使い分けのポイント

#### Elastic Beanstalk を選ぶケース

- 標準的な Web アプリケーションのデプロイ
- インフラストラクチャの詳細を気にしたくない場合
- 迅速なアプリケーション開発とデプロイが必要な場合
- 開発チームが小規模で、運用リソースが限られている場合

#### CloudFormation を選ぶケース

- カスタマイズされたインフラストラクチャが必要な場合
- 複数の AWS サービスを連携させる必要がある場合
- インフラストラクチャの完全な制御が必要な場合
- 大規模なシステム基盤の構築

### 併用のメリット

- Elastic Beanstalk 環境を CloudFormation で定義可能
- 環境のバージョン管理と再現性の向上
- インフラストラクチャとアプリケーションの一元管理
- 本番環境と開発環境の一貫性確保
