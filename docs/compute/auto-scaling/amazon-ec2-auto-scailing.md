# Amazon EC2 Auto Scaling

## Auto Scaling とは

Auto Scaling は、アプリケーションの需要に応じて自動的に EC2 インスタンス（仮想サーバー）の数を増減させるサービスです。例えば、ウェブサイトへのアクセスが増えた時に自動的にサーバーを増やし、アクセスが減った時に自動的にサーバーを減らすことができます。

## メリット

- **コスト最適化**: 必要な時だけリソースを使用するため、無駄な支払いを抑えられます
- **可用性の向上**: サーバーに障害が発生しても自動的に新しいサーバーが起動します
- **柔軟な対応**: トラフィックの変動に合わせて自動的にスケールするため、人手による管理が不要です

## Auto Scaling の重要な機能

### スケーリングポリシー

Auto Scaling グループがいつ、どのようにスケールするかを定義するルールです。

- **シンプルスケーリング**

  - 基本的な増減ルール（例：CPU 使用率が 80%を超えたら 1 台追加）
  - 単純な条件での制御に適している

- **ステップスケーリング**

  - 段階的な増減ルール（例：CPU 使用率が 80%超で 1 台、90%超で 2 台追加）
  - より細かな制御が可能

- **ターゲット追跡スケーリング**
  - 目標値に基づく自動調整（例：CPU 使用率を常に 60%前後に維持）
  - 最も管理が簡単で推奨される方式

💡 **一般向け解説**：  
お店の混雑状況に応じてレジ係を増減させるようなものです。ステップスケーリングは「少し混んできたら 1 人、かなり混んできたら 2 人追加」といった具合に、状況に応じて柔軟に対応できます。

### ウォームアップ期間

新しく起動したインスタンスが完全に機能するまでの準備期間を設定します。

- **主な設定項目**
  - アプリケーションの起動時間
  - 初期化処理の完了時間
  - ヘルスチェックの待機時間

💡 **一般向け解説**：  
新しい従業員が仕事を始める前に必要な準備時間のようなものです。制服に着替えたり、レジの使い方を確認したりする時間を確保するイメージです。

### クールダウン期間

スケーリング活動後、次のスケーリングまでの待機時間を設定します。

- **主な目的**
  - 不必要なスケーリングの防止
  - システムの安定性確保
  - コスト効率の向上

💡 **一般向け解説**：  
お店に新しいレジ係を配置した後、その効果を見極めるための観察期間のようなものです。すぐに別の判断をするのではなく、一定時間様子を見ます。

### ヘルスチェック

インスタンスの健全性を定期的に確認する機能です。

- **チェック項目**

  - システムステータス（ハードウェアやソフトウェアの状態）
  - インスタンスステータス（アプリケーションの応答）
  - カスタムヘルスチェック（独自の確認項目）

- **異常検知時の動作**
  - 問題のあるインスタンスの終了
  - 新しい健全なインスタンスの起動
  - 通知の送信

💡 **一般向け解説**：  
従業員の体調チェックのようなものです。具合が悪そうな従業員がいれば、別の従業員と交代させて、お店の運営に支障が出ないようにします。

### ライフサイクルフック

インスタンスの起動や終了時に特定の処理を実行できる機能です。

- **起動時のフック例**

  - アプリケーションのインストール
  - データベースへの接続設定
  - セキュリティ設定の適用

- **終了時のフック例**
  - ログデータの保存
  - キャッシュデータのクリーンアップ
  - 他システムへの通知

💡 **一般向け解説**：  
新入社員の入社時や退職時の手続きチェックリストのようなものです。入社時には制服の支給やトレーニングの実施、退職時には制服の返却や引き継ぎ作業など、必要な手続きを漏れなく実施できます。

### 容量設定

- **最小容量**: 常に維持する最小インスタンス数
- **最大容量**: スケールアップ時の上限
- **希望容量**: 通常時に維持したいインスタンス数

## スケーリングの種類

### 垂直スケーリング（スケールアップ/ダウン）

インスタンスのスペックを変更することで処理能力を調整する方法です。

- **メリット**

  - シンプルな構成を維持できる
  - アプリケーションの変更が不要
  - データベースなどのステートフルなワークロードに適している

- **デメリット**
  - インスタンスの再起動が必要
  - ハードウェアの制限により、無制限なスケールアップはできない
  - コストが比例的に増加する

### 水平スケーリング（スケールアウト/イン）

インスタンスの数を増減させることで処理能力を調整する方法です。EC2 Auto Scaling が主にサポートするのはこの方式です。

- **メリット**

  - 理論上、無制限にスケールアウト可能
  - 高可用性の実現が容易
  - コストを効率的に管理できる

- **デメリット**
  - アプリケーションがステートレスである必要がある
  - ロードバランサーなどの追加コンポーネントが必要
  - アプリケーションの設計が複雑になる可能性がある

### 使い分けのポイント

- **垂直スケーリングの適用例**

  - データベースサーバー
  - レガシーアプリケーション
  - ライセンス制限のあるソフトウェア

- **水平スケーリングの適用例**
  - Web アプリケーション
  - マイクロサービス
  - バッチ処理システム

## 使用例

### Web サイトの場合

- 平日の日中はアクセスが多いため、自動的にサーバーを増やす
- 夜間や休日はアクセスが少ないため、自動的にサーバーを減らす
- 突発的なアクセス増加にも自動対応

### E コマースサイトの場合

- セール期間中は自動的にサーバー数を増やす
- 通常期間は必要最小限のサーバーで運用
- 季節変動にも柔軟に対応

## 注意点

- 新しいインスタンスの起動には数分かかる場合があります
- データベースなど、すぐにスケールできないサービスには不向きです
- 適切なモニタリングと閾値設定が重要です

## まとめ

Auto Scaling は、サーバーリソースを需要に応じて自動調整することで、コスト効率と可用性を両立させるサービスです。適切に設定することで、人手による管理を最小限に抑えながら、安定したサービス運用が可能になります。

## AWS の Auto Scaling サービス

AWS には目的に応じて 3 つの異なる Auto Scaling サービスが用意されています：

### 1. Amazon EC2 Auto Scaling

EC2 インスタンス（仮想サーバー）の数を自動的に調整します。

- **スケーリング対象**

  - EC2 インスタンス
  - EC2 フリート（スポットフリートとオンデマンドの混在が可能）

- **主な用途**
  - Web アプリケーションサーバー
  - バッチ処理システム
  - マイクロサービス

### 2. Application Auto Scaling

AWS の各種サービスのキャパシティを自動的に調整します。

- **スケーリング対象**

  - Amazon ECS（コンテナサービス）
  - Amazon DynamoDB（NoSQL データベース）
  - Amazon Aurora（リレーショナルデータベース）
  - Amazon EMR（分散処理クラスター）
  - Lambda（サーバーレス関数）のプロビジョニングされた同時実行数

- **主な用途**
  - コンテナベースのアプリケーション
  - データベースのスループット調整
  - サーバーレスアプリケーション

### 3. AWS Auto Scaling

複数のリソースにまたがるスケーリングを一元的に管理します。

- **スケーリング対象**

  - EC2 Auto Scaling グループ
  - Application Auto Scaling のターゲット
  - 複数の AWS リソースを組み合わせたアプリケーション

- **主な特徴**
  - 複数のリソースを統合的に管理
  - 推奨されるスケーリング設定を自動提案
  - パフォーマンスとコストの最適化を自動化

### サービスの選択基準

- **EC2 Auto Scaling**: EC2 インスタンスのみをスケールする場合
- **Application Auto Scaling**: 特定の AWS サービスのキャパシティを調整する場合
- **AWS Auto Scaling**: 複数のリソースを統合的に管理する必要がある場合
