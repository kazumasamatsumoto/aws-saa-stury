# Amazon Virtual Private Cloud (VPC)

AWS クラウド内の論理的に分離されたネットワーク空間を提供するサービスです。

## VPC の主要コンポーネント

### VPC とサブネット

- **VPC**: AWS アカウント専用の仮想ネットワーク
  - IP アドレス範囲を CIDR ブロックで指定
  - リージョンに紐付く
- **サブネット**: VPC 内の IP アドレスの範囲
  - パブリックサブネット：インターネットへの直接アクセスが可能
  - プライベートサブネット：インターネットへの直接アクセスが不可

### セキュリティ

#### セキュリティグループ

- インスタンスレベルのファイアウォール
- ステートフル（戻りの通信を自動許可）
- 許可ルールのみ設定可能
- デフォルトではすべての通信をブロック

#### ネットワーク ACL (NACL)

- サブネットレベルのファイアウォール
- ステートレス（戻りの通信も明示的に許可が必要）
- 許可と拒否のルールを設定可能
- 番号付きのルールで評価順序を制御

### VPC Flow Logs

- VPC 内のネットワークトラフィックをキャプチャ
- CloudWatch または S3 に保存可能
- セキュリティ分析やトラブルシューティングに使用

### VPC Peering

- 異なる VPC 間の通信を可能にする接続
- 同一または異なるアカウント/リージョン間で設定可能
- 推移的な接続は不可（A-B-C 間の接続にはそれぞれピアリングが必要）

### VPC エンドポイント

- **インターフェイスエンドポイント**:
  - プライベート IP を使用して AWS サービスに接続
  - Powered by AWS PrivateLink
- **ゲートウェイエンドポイント**:
  - S3 や DynamoDB への接続に使用
  - ルートテーブルのターゲットとして機能

### Elastic Network Interface (ENI)

- 仮想ネットワークカード
- EC2 インスタンスに複数のネットワークインターフェースを提供
- セカンダリ IP アドレスの割り当てが可能

### ゲートウェイ

- **インターネットゲートウェイ (IGW)**:
  - VPC とインターネット間の通信を可能にする
  - パブリックサブネットに必要
- **NAT ゲートウェイ**:
  - プライベートサブネットからインターネットへの送信通信を可能にする
  - 受信通信はブロック
- **仮想プライベートゲートウェイ (VGW)**:
  - VPN を介したオンプレミス接続用
  - Site-to-Site VPN 接続に使用

## ベストプラクティス

- 適切な CIDR 範囲の計画
- パブリック/プライベートサブネットの適切な分離
- セキュリティグループと NACL の適切な設定
- Flow Logs による監視
- 必要に応じた VPC エンドポイントの活用

## アドレス設計と割り当て

### CIDR 設計

- CIDR（Classless Inter-Domain Routing）形式で指定
- VPC のサイズは/16 ～/28 の範囲で設定可能
  - /16 = 65,536 個の IP アドレス
  - /28 = 16 個の IP アドレス
- 各サブネットで予約される IP アドレス
  - 最初の 4 個：ネットワークアドレス、VPC ルーター等
  - 最後の 1 個：ブロードキャストアドレス

### IP アドレスの種類

#### Elastic IP アドレス

- 静的なパブリック IPv4 アドレス
- EC2 インスタンス間で再割り当て可能
- 料金体系：
  - インスタンスに関連付け済み：無料
  - 未使用の場合：課金対象
  - 1 インスタンスに複数割り当て：課金対象

#### 自動割り当てパブリック IP アドレス

- AWS が自動的に割り当てる動的なパブリック IP アドレス
- インスタンスの停止/終了時に解放
- 再起動時に新しいアドレスが割り当て

### サブネットの設計

- 1 つの VPC に最大 200 個のサブネットを作成可能
- 各サブネットに仮想ルーターが存在
- 用途に応じた適切なサイズ設計が重要
  - アドレス枯渇の防止
  - コスト最適化（未使用 IP アドレスの最小化）

### インターネット接続

- パブリックサブネット：
  - インターネットゲートウェイ経由で直接接続
  - パブリック IP アドレスが必要
- プライベートサブネット：
  - NAT ゲートウェイ経由で外部接続
  - 内部からの送信のみ可能

## 一般向け解説：VPC（Virtual Private Cloud）とは？

### 簡単に言うと？

VPC は、AWS クラウド内の「専用の区画」や「マイホーム」のようなものです。例えると：

- 🏰 マンション内の専用の部屋
- 🏢 オフィスビル内の専用フロア
- 🏡 塀で囲まれた私有地

### どんなことができるの？

1. **プライベートな空間作り**

   - 🔐 他の利用者と完全に分離された環境
   - 🎨 自由にネットワークを設計可能
   - 🏗️ 好きなようにサーバーを配置

2. **セキュリティ管理**

   - 🚪 誰を入れるか、出るかを管理
   - 🛡️ 不正アクセスからの保護
   - 👥 アクセス権限の細かい設定

### 主な機能と例え

1. **サブネット**

   ```
   例：マンションの各部屋や区画のようなもの
   - パブリックサブネット ＝ 道路に面した店舗
   - プライベートサブネット ＝ 内側の居住スペース
   ```

2. **インターネットゲートウェイ**

   ```
   例：建物の正面玄関
   - 外部との出入り口
   - 必要な場合のみ設置
   ```

3. **セキュリティグループ**
   ```
   例：各部屋の鍵やセキュリティシステム
   - 誰を入れるか？
   - どんな通信を許可するか？
   ```

### よくある使い方

1. **Web サービスの構築**

   - 🌐 パブリックな場所に Web サーバー
   - 🔒 プライベートな場所にデータベース
   - 🛡️ 重要なデータを安全に管理

2. **社内システムの構築**

   - 👥 社員専用のアプリケーション
   - 📁 機密文書の保管
   - 💼 業務システムの運用

### 注意点

1. **設計時の注意**

   - 📐 後から変更が難しい項目もある
   - 🎯 将来の拡張性を考慮
   - 📝 アドレス設計は慎重に

2. **コストの考慮**
   - 💰 使用する機能によって料金が発生
   - 📊 トラフィック量による課金
   - 🏷️ 適切なサイズ選択が重要

### よくある質問

Q1: VPC は必ず必要？

- ✅ はい、AWS でサーバーを使う場合は基本的に必要です

Q2: 複数の VPC を作れる？

- ⭕ はい、用途に応じて複数作成できます

Q3: 後から設定変更できる？

- 🔄 一部の設定は変更可能ですが、基本設計は慎重に行うべきです

### まとめ

VPC は、AWS クラウド内の「自分だけの安全な空間」です：

- 🏠 専用の環境が作れる
- 🔒 セキュリティ管理が可能
- 🎮 自由度の高い設計が可能

特に：

- 💼 企業システムの構築
- 🌐 Web サービスの提供
- 🔐 セキュアな環境の構築

に適しています。
