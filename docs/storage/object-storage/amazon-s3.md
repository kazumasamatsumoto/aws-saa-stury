# AWS ストレージサービス概要

## 1. Amazon S3 (Simple Storage Service)

- オブジェクトストレージサービス
- 無制限のファイル保存が可能
- 高い耐久性と可用性
- ユースケース：
  - 静的ウェブサイトホスティング
  - バックアップ・アーカイブ
  - ビッグデータ分析
  - コンテンツ配信

## 2. Amazon EBS (Elastic Block Store)

- ブロックストレージサービス
- EC2 インスタンス用の永続的なストレージ
- ユースケース：
  - データベース
  - ファイルシステム
  - アプリケーションホスティング

## 3. Amazon EFS (Elastic File System)

- フルマネージド型の NFS ファイルシステム
- 複数の EC2 インスタンスから同時アクセス可能
- ユースケース：
  - コンテンツ管理
  - ウェブサービング
  - データ共有

## 4. Amazon S3 Glacier

- 長期データアーカイブ用の低コストストレージ
- データ取り出しに時間がかかる
- ユースケース：
  - 長期バックアップ
  - アーカイブデータ
  - コンプライアンス要件のデータ保管

## 5. AWS Storage Gateway

- オンプレミス環境と AWS ストレージサービスを統合
- ハイブリッドクラウドストレージソリューション
- ユースケース：
  - バックアップと復旧
  - クラウドデータ処理
  - ストレージの階層化

## Amazon S3 の詳細

### ストレージクラス

- **S3 Standard**

  - 高頻度アクセスデータ向け
  - 99.99%の可用性
  - 複数のアベイラビリティーゾーンにデータを保存

- **S3 Intelligent-Tiering**

  - アクセスパターンが変化するデータに最適
  - アクセス頻度に応じて自動的にデータを移動
  - 監視・自動化コストが月額発生

- **S3 Standard-IA (Infrequent Access)**

  - アクセス頻度の低いデータ向け
  - 取り出し時に料金が発生
  - バックアップデータに最適

- **S3 One Zone-IA**
  - 単一の AZ にデータを保存
  - Standard-IA より低コスト
  - 再作成可能なデータに適している

### 主要な機能

1. **バージョニング**

   - オブジェクトの複数バージョンを保持
   - 誤削除や上書きからの保護
   - 変更履歴の追跡が可能

2. **ライフサイクル管理**

   - 自動的なデータ移行ルールの設定
   - コスト最適化のための自動化
   - 有効期限切れデータの自動削除

3. **セキュリティ機能**

   - IAM によるアクセス制御
   - バケットポリシーによる詳細な権限設定
   - サーバーサイド暗号化（SSE）
   - VPC エンドポイントによるプライベートアクセス

4. **データ管理**
   - イベント通知
   - クロスリージョンレプリケーション
   - タグ付けによる分類
   - オブジェクトのメタデータ管理

### 一般的なユースケース例

1. **静的ウェブサイトホスティング**

   - HTML ファイル、画像、CSS の保存
   - CloudFront と組み合わせた高速配信
   - カスタムドメインの使用が可能

2. **データレイク**

   - 構造化・非構造化データの保存
   - Athena による直接クエリ
   - EMR との連携による分析

3. **バックアップ/アーカイブ**
   - データベースバックアップの保存
   - ログファイルの長期保存
   - コンプライアンス要件への対応

### コスト最適化のベストプラクティス

- 適切なストレージクラスの選択
- ライフサイクルルールの活用
- 不要なバージョンの削除
- 適切なバケットポリシーの設定
- モニタリングとコスト分析の実施

### S3 のセキュリティ機能

#### 1. アクセス制御

- **IAM ポリシー**

  - ユーザー、グループ、ロールベースのアクセス制御
  - きめ細かな権限管理が可能
  - AWS サービス間の連携に最適

- **バケットポリシー**

  - バケット単位でのアクセス制御
  - JSON 形式での権限定義
  - IP アドレスベースのアクセス制限
  - クロスアカウントアクセスの設定

- **ACL (Access Control Lists)**

  - オブジェクト単位でのアクセス制御
  - 基本的な read/write 権限の設定
  - レガシーな権限管理方式

- **署名付き URL**
  - 一時的なアクセス権限の付与
  - 有効期限の設定が可能
  - プライベートコンテンツの安全な共有
  - CloudFront と組み合わせた配信が可能

#### 2. CORS (Cross-Origin Resource Sharing)

- 異なるドメイン間のリソース共有を制御
- Web アプリケーションのセキュリティ確保
- XMLHttpRequest や Fetch API のアクセス制御
- 許可するドメインの明示的な設定

#### 3. 暗号化オプション

- **サーバーサイド暗号化（SSE）**

  - SSE-S3: Amazon S3 管理キー
  - SSE-KMS: AWS KMS 管理キー
  - SSE-C: カスタマー提供キー

- **クライアントサイド暗号化**
  - データ送信前の暗号化
  - キーの完全な管理権限

#### 4. オブジェクトロック

- **ガバナンスモード**

  - 特別な権限を持つユーザーのみが削除可能
  - コンプライアンス要件への対応

- **コンプライアンスモード**
  - 設定期間中は誰も削除・変更不可
  - WORM（Write Once Read Many）の実現
  - 法規制要件への対応

#### 5. バージョニング

- オブジェクトの変更履歴を保持
- 意図しない削除や上書きからの保護
- 以前のバージョンへの復元が可能
- MFA Delete の設定による削除保護

#### セキュリティのベストプラクティス

1. 最小権限の原則に基づくアクセス制御
2. パブリックアクセスのブロック設定
3. バケットとオブジェクトの暗号化の強制
4. アクセスログの有効化と監視
5. AWS Config や CloudTrail との統合
6. 定期的なセキュリティ評価の実施

### S3 の操作機能

#### 1. バッチオペレーション

- **大規模なオブジェクト操作の自動化**

  - 数十億個のオブジェクトに対する一括操作
  - 進捗管理と完了レポートの生成
  - ジョブの優先順位付けと管理

- **主な操作タイプ**
  - オブジェクトのコピー
  - タグの設定・更新
  - ACL の変更
  - オブジェクトの復元（Glacier）
  - Lambda 関数の呼び出し

#### 2. マルチパートアップロード

- **大容量ファイルの効率的なアップロード**

  - 最大 5TB までのオブジェクトに対応
  - パート単位での並列アップロード
  - ネットワーク状態に応じた再開機能

- **利点**
  - アップロード速度の向上
  - ネットワーク使用効率の最適化
  - 耐障害性の向上
  - 帯域幅の有効活用

#### 3. S3 Transfer Acceleration

- **長距離データ転送の高速化**

  - CloudFront のエッジロケーションを活用
  - 最適化されたネットワークパス
  - グローバルな転送速度の向上

- **ユースケース**
  - グローバルに分散したユーザーからのアップロード
  - 定期的な大容量データ転送
  - クロスリージョンデータ同期

#### 4. S3 Select

- **オブジェクト内のデータ抽出を最適化**

  - SQL ライクなクエリによるデータ取得
  - サーバー側でのフィルタリング
  - 転送データ量の削減

- **対応フォーマット**

  - CSV
  - JSON
  - Parquet
  - BZIP2 圧縮ファイル

- **メリット**
  - アプリケーションのパフォーマンス向上
  - データ転送コストの削減
  - 処理時間の短縮
  - クライアント側の負荷軽減

#### 操作のベストプラクティス

1. 大容量ファイル（100MB 以上）にはマルチパートアップロードを使用
2. グローバルアクセスには Transfer Acceleration の活用
3. 大規模な一括操作にはバッチオペレーションを使用
4. 大容量データの分析には S3 Select を活用
5. 適切なパートサイズの選択（通常 5MB 以上）
6. 並列処理による転送の最適化

## 各ストレージタイプの特徴比較

| ストレージタイプ | アクセス速度 | コスト | 用途                 | 推奨シナリオ                                                                                                                                               |
| ---------------- | ------------ | ------ | -------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| S3               | 中           | 中     | 一般的なデータ保存   | - 画像・動画のメディアホスティング<br>- モバイルアプリのコンテンツ配信<br>- データレイクの構築                                                             |
| EBS              | 高           | 高     | 高性能ワークロード   | - MySQL や PostgreSQL などのデータベースサーバー<br>- SAP HANA や Oracle などのエンタープライズアプリケーション<br>- Jenkins などの CI/CD パイプライン環境 |
| EFS              | 中-高        | 高     | 共有ファイルシステム | - コンテナ間のデータ共有<br>- ビッグデータ分析環境<br>- Web サーバーのコンテンツ管理                                                                       |
| Glacier          | 低           | 低     | 長期アーカイブ       | - 医療画像の長期保管<br>- 法規制に基づく記録保持<br>- メディアアーカイブ                                                                                   |
