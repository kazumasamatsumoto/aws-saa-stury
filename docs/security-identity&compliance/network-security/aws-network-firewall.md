# AWS Network Firewall

AWS Network Firewall は、VPC のネットワークトラフィックを保護するためのマネージド型ファイアウォールサービスです。

## 主な特徴

### 1. 高度なトラフィック制御

- ステートフルインスペクション
- プロトコルレベルでの詳細な制御
- カスタムルールの作成と適用
- ドメインリストベースのフィルタリング

### 2. 集中管理

- 複数 VPC の一元管理
- AWS Firewall Manager との統合
- ルールの一括適用と管理

<div align="center">
<img src="/image/security-identity&compliance/network-security/network-firewall-architecture.svg" alt="AWS Network Firewall Architecture" width="800"/>
</div>

### 3. セキュリティ機能

- 侵入検知・防止（IDS/IPS）
- マルウェア対策
- Web フィルタリングと SSL/TLS 検査
- アプリケーションレイヤーでの制御

## 防御対象の脅威

### 1. ネットワーク攻撃からの保護

- **DDoS 攻撃**

  - 大量のトラフィックによるサービス妨害攻撃を検知・ブロック
  - 異常なトラフィックパターンの特定と制御

- **ポートスキャン攻撃**

  - 不正なポートスキャンの検知
  - 未使用ポートへのアクセス試行のブロック

- **プロトコル攻撃**
  - プロトコルの脆弱性を突く攻撃の防御
  - 不正なパケットの検知とフィルタリング

### 2. アプリケーション層の攻撃対策

- **SQL インジェクション**

  - 不正な SQL コマンドの検知とブロック
  - データベースへの不正アクセス防止

- **クロスサイトスクリプティング（XSS）**

  - 悪意のあるスクリプトの検知
  - Web アプリケーションの保護

- **コマンドインジェクション**
  - シェルコマンドの不正実行の防止
  - システムコマンドの実行制御

### 3. マルウェア対策

- **C&C サーバー通信のブロック**

  - マルウェアの制御サーバーとの通信遮断
  - 既知の悪意あるドメインへのアクセス防止

- **ボットネット対策**
  - 感染端末の検知
  - 不正な通信パターンの特定とブロック

### 4. データ漏洩防止

- **機密情報の外部送信検知**

  - 重要データの外部送信モニタリング
  - 不正なデータ転送の防止

- **暗号化通信の検査**
  - SSL/TLS 通信の内容確認
  - 暗号化された攻撃の検知

<div align="center">
<img src="/image/security-identity&compliance/network-security/network-firewall-threats.svg" alt="AWS Network Firewall Threat Protection" width="800"/>
</div>

## ユースケース

1. **境界セキュリティの強化**

   - インターネットと VPC 間のトラフィック制御
   - 不正アクセスの防止
   - マルウェアからの保護

2. **コンプライアンス対応**

   - 規制要件への適合
   - トラフィックの監査とログ記録
   - セキュリティポリシーの適用

3. **VPC 間通信の制御**
   - 内部ネットワークセグメンテーション
   - マイクロサービス間の通信制御
   - 開発環境と本番環境の分離

## 設定のベストプラクティス

1. **ルール設計**

   - 最小権限の原則に基づく設定
   - 必要なトラフィックのみを許可
   - 定期的なルールの見直しと更新

2. **可用性の確保**

   - 複数のアベイラビリティーゾーンへの展開
   - フェイルオーバー設定
   - バックアップと復旧計画の策定

3. **モニタリングと運用**
   - CloudWatch との統合
   - アラートの設定
   - 定期的なセキュリティ評価

## 料金

- エンドポイントごとの時間単位の料金
- 処理されたトラフィック量に応じた従量課金
- データ転送料金

## 制限事項

- リージョン単位での展開
- VPC ごとのエンドポイント数制限
- ルール数の制限

## アーキテクチャ

AWS Network Firewall は、VPC の境界で動作し、トラフィックが VPC に到達する前に検査を行います。具体的には：

1. **配置場所**

   - VPC の外側（AWS 管理下）に配置
   - トラフィックはまず Network Firewall を通過
   - その後、検査済みの安全なトラフィックのみが VPC に到達

2. **トラフィックフロー**

   - インターネットからのトラフィック → Network Firewall → VPC
   - VPC からのトラフィック → Network Firewall → インターネット
   - VPC 間通信も必要に応じて Network Firewall を経由可能

3. **実装方式**
   - 専用のファイアウォール VPC エンドポイントを作成
   - ルートテーブルでトラフィックをファイアウォールエンドポイントに転送
   - 高可用性のために複数のアベイラビリティーゾーンに展開
